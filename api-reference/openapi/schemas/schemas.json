{
  "components": {
    "schemas": {
      "DocumentBatch": {
        "type": "object",
        "required": [
          "documents"
        ],
        "properties": {
          "documents": {
            "type": "array",
            "description": "Array de documentos a crear (máximo 200)",
            "items": {
              "$ref": "#/components/schemas/Document"
            }
          }
        }
      },
      "Document": {
        "type": "object",
        "required": [
          "dte_type",
          "document_issuer",
          "document_receiver",
          "details"
        ],
        "properties": {
          "date_issued": {
            "type": "string",
            "format": "date",
            "description": "Fecha de emisión (YYYY-MM-DD). Si X-Use-Defaults es true y no se proporciona, se usa la fecha actual."
          },
          "folio": {
            "type": "string",
            "description": "Folio del documento. Si X-Use-Defaults es true y no se proporciona, se genera automáticamente."
          },
          "dte_type": {
            "$ref": "#/components/schemas/DteType"
          },
          "document_issuer": {
            "$ref": "#/components/schemas/DocumentIssuer"
          },
          "document_receiver": {
            "$ref": "#/components/schemas/DocumentReceiver"
          },
          "details": {
            "type": "array",
            "minItems": 1,
            "items": {
              "$ref": "#/components/schemas/DetailItem"
            }
          },
          "header": {
            "$ref": "#/components/schemas/DocumentHeader"
          },
          "references": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ReferenceItem"
            }
          },
          "json_param": {
            "type": "object",
            "additionalProperties": true,
            "description": "JSON arbitrario almacenado textualmente"
          },
          "export_data": {
            "$ref": "#/components/schemas/ExportData"
          }
        }
      },
      "DteType": {
        "type": "object",
        "required": [
          "code"
        ],
        "properties": {
          "code": {
            "type": "string",
            "description": "Código del tipo de documento:\n- 33: Factura Electrónica\n- 34: Factura Exenta Electrónica\n- 39: Boleta Electrónica\n- 46: Factura de Compra Electrónica\n- 61: Nota de Crédito Electrónica\n- 80: Boleta de Honorarios Electrónica\n- 110: Factura de Exportación Electrónica",
            "enum": [
              "33",
              "34",
              "39",
              "46",
              "61",
              "80",
              "110"
            ]
          }
        }
      },
      "DocumentHeader": {
        "type": "object",
        "properties": {
          "purchase_transaction_type": {
            "type": "string",
            "description": "Tipo de transacción de compra",
            "nullable": true
          },
          "sale_transaction_type": {
            "type": "string",
            "description": "Tipo de transacción de venta",
            "nullable": true
          },
          "payment_method": {
            "type": "string",
            "description": "Método de pago",
            "enum": [
              "1",
              "2",
              "3"
            ],
            "nullable": true
          },
          "due_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de vencimiento",
            "nullable": true
          },
          "vat_withheld": {
            "type": "boolean",
            "description": "Indica si el IVA está retenido. Solo aplicable para facturas de compra (DTE 46) y notas de crédito que referencian facturas de compra.",
            "example": false,
            "nullable": true
          },
          "retention_type": {
            "type": "string",
            "description": "Tipo de retención obligatorio para boletas de honorarios (DTE 80). Define quién retiene el 14,5% legal.",
            "enum": [
              "RETRECEPTOR",
              "RETCONTRIBUYENTE"
            ],
            "example": "RETRECEPTOR",
            "nullable": true
          },
          "purchase_type": {
            "type": "string",
            "description": "Tipo de compra para facturas recibidas en el SII",
            "enum": [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7"
            ],
            "example": "1",
            "nullable": true
          }
        }
      },
      "DocumentIssuer": {
        "type": "object",
        "required": [
          "rut"
        ],
        "properties": {
          "rut": {
            "type": "string",
            "description": "RUT sin puntos y con guion, ej: 76543210-K. Si X-Use-Defaults es true, los demás campos se rellenarán automáticamente según la configuración.",
            "pattern": "^[0-9]{7,8}-[0-9K]$"
          },
          "business_name": {
            "type": "string",
            "description": "Razón social"
          },
          "phone_number": {
            "type": "string",
            "description": "Número de teléfono"
          },
          "email": {
            "type": "string",
            "description": "Correo electrónico"
          },
          "business_activity": {
            "type": "string",
            "description": "Giro comercial"
          },
          "activity_code": {
            "type": "integer",
            "description": "Código de actividad económica"
          },
          "sii_branch_code": {
            "type": "string",
            "description": "Código de sucursal SII"
          },
          "address": {
            "type": "string",
            "description": "Dirección"
          },
          "district": {
            "type": "string",
            "description": "Comuna"
          },
          "city": {
            "type": "string",
            "description": "Ciudad"
          }
        }
      },
      "DocumentReceiver": {
        "type": "object",
        "required": [
          "rut"
        ],
        "properties": {
          "rut": {
            "type": "string",
            "description": "RUT sin puntos y con guion, ej: 76543210-K. Si X-Use-Defaults es true, los demás campos se rellenarán automáticamente según la configuración.",
            "pattern": "^[0-9]{7,8}-[0-9K]$"
          },
          "business_name": {
            "type": "string",
            "description": "Razón social"
          },
          "contact": {
            "type": "string",
            "description": "Contacto"
          },
          "business_activity": {
            "type": "string",
            "description": "Giro comercial"
          },
          "address": {
            "type": "string",
            "description": "Dirección"
          },
          "district": {
            "type": "string",
            "description": "Comuna"
          },
          "city": {
            "type": "string",
            "description": "Ciudad"
          }
        }
      },
      "DetailItem": {
        "type": "object",
        "required": [
          "item_name",
          "quantity",
          "unit_price"
        ],
        "properties": {
          "item_name": {
            "type": "string",
            "description": "Nombre del ítem"
          },
          "quantity": {
            "type": "number",
            "description": "Cantidad"
          },
          "unit_price": {
            "type": "number",
            "format": "float",
            "description": "Precio unitario"
          },
          "item_description": {
            "type": "string",
            "description": "Descripción del ítem"
          },
          "discount_percent": {
            "type": "number",
            "format": "float",
            "description": "Porcentaje de descuento"
          },
          "item_total": {
            "type": "number",
            "format": "float",
            "description": "Total del ítem"
          },
          "item_code": {
            "type": "string",
            "description": "Código del ítem"
          },
          "unit": {
            "type": "string",
            "description": "Unidad de medida"
          },
          "other_tax": {
            "type": "number",
            "format": "float",
            "description": "Otros impuestos"
          },
          "item_type_code": {
            "type": "integer",
            "description": "Código de tipo de ítem"
          }
        }
      },
      "ReferenceItem": {
        "type": "object",
        "required": [
          "reference_folio",
          "reference_date",
          "dte_type_code"
        ],
        "properties": {
          "reference_folio": {
            "type": "integer",
            "description": "Folio de referencia"
          },
          "reference_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de referencia"
          },
          "reference_reason": {
            "type": "string",
            "description": "Razón de referencia. Para notas de crédito totales debe ser 'ANULA DOCUMENTO DE LA REFERENCIA'.",
            "example": "ANULA DOCUMENTO DE LA REFERENCIA"
          },
          "dte_type_code": {
            "type": "string",
            "description": "Código del tipo de DTE del documento referenciado"
          }
        }
      },
      "BatchResponse": {
        "type": "object",
        "properties": {
          "batch_id": {
            "type": "string",
            "format": "uuid",
            "description": "Identificador único del lote"
          },
          "status": {
            "type": "string",
            "description": "Estado del batch",
            "enum": [
              "created",
              "processing",
              "completed",
              "failed"
            ],
            "example": "processing"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha y hora de creación del batch"
          },
          "documents": {
            "type": "array",
            "description": "Array de documentos procesados en el batch",
            "items": {
              "type": "object",
              "properties": {
                "index": {
                  "type": "integer",
                  "description": "Índice del documento en el array original"
                },
                "status": {
                  "type": "string",
                  "enum": [
                    "created",
                    "processing",
                    "success",
                    "invalid",
                    "temporary_error",
                    "permanent_error",
                    "incomplete"
                  ],
                  "description": "Estado de procesamiento del documento"
                },
                "document": {
                  "type": "object",
                  "nullable": true,
                  "description": "Información completa del documento (solo presente si status permite tener documento)",
                  "properties": {
                    "id": {
                      "type": "integer",
                      "description": "ID único del documento creado"
                    },
                    "folio": {
                      "type": "string",
                      "nullable": true,
                      "description": "Número de folio del documento"
                    },
                    "date_issued": {
                      "type": "string",
                      "format": "date",
                      "description": "Fecha de emisión del documento"
                    },
                    "amount_with_iva": {
                      "type": "number",
                      "format": "float",
                      "description": "Monto total con IVA"
                    },
                    "receiver_id": {
                      "type": "integer",
                      "nullable": true,
                      "description": "ID de la entidad receptora"
                    },
                    "is_draft": {
                      "type": "boolean",
                      "description": "Indica si el documento es un borrador"
                    },
                    "can_be_issued": {
                      "type": "boolean",
                      "description": "Indica si el documento puede ser emitido"
                    },
                    "dte_type": {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "description": "Código del tipo de DTE"
                        },
                        "description": {
                          "type": "string"
                        }
                      }
                    },
                    "sender": {
                      "type": "object",
                      "nullable": true,
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "name": {
                          "type": "string"
                        },
                        "tax_id": {
                          "type": "string"
                        }
                      }
                    },
                    "receiver": {
                      "type": "object",
                      "nullable": true,
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "name": {
                          "type": "string"
                        },
                        "tax_id": {
                          "type": "string"
                        }
                      }
                    },
                    "items": {
                      "type": "array",
                      "description": "Array de productos/servicios del documento",
                      "items": {
                        "type": "object",
                        "properties": {
                          "item_name": {
                            "type": "string"
                          },
                          "item_description": {
                            "type": "string",
                            "nullable": true
                          },
                          "quantity": {
                            "type": "number",
                            "nullable": true
                          },
                          "unit_price": {
                            "type": "number",
                            "nullable": true
                          },
                          "item_total": {
                            "type": "number",
                            "nullable": true
                          },
                          "unit": {
                            "type": "string",
                            "nullable": true
                          },
                          "item_code": {
                            "type": "string",
                            "nullable": true
                          },
                          "item_type_code": {
                            "type": "integer",
                            "nullable": true
                          },
                          "discount_percent": {
                            "type": "number",
                            "nullable": true
                          },
                          "other_tax": {
                            "type": "number",
                            "nullable": true
                          }
                        }
                      }
                    },
                    "document_total": {
                      "type": "object",
                      "nullable": true,
                      "properties": {
                        "net_amount": {
                          "type": "number",
                          "nullable": true
                        },
                        "iva_rate": {
                          "type": "number",
                          "nullable": true
                        },
                        "iva_amount": {
                          "type": "number",
                          "nullable": true
                        },
                        "total_amount": {
                          "type": "number",
                          "nullable": true
                        }
                      }
                    },
                    "pdf_url": {
                      "type": "string",
                      "format": "uri",
                      "nullable": true,
                      "description": "URL presignada al PDF del documento (válida por 2 horas)"
                    },
                    "pdf_download_url": {
                      "type": "string",
                      "nullable": true,
                      "description": "URL de descarga del PDF"
                    },
                    "retention_type": {
                      "type": "string",
                      "nullable": true,
                      "description": "Tipo de retención para boletas de honorarios (DTE 80, 90)",
                      "enum": [
                        "RETRECEPTOR",
                        "RETCONTRIBUYENTE"
                      ]
                    },
                    "export_data": {
                      "type": "object",
                      "nullable": true,
                      "description": "Datos de exportación para facturas internacionales (DTE 110, 111, 112)"
                    }
                  }
                },
                "errors": {
                  "type": "object",
                  "nullable": true,
                  "description": "Errores de validación si el estado es 'invalid' o hay errores"
                }
              }
            }
          }
        }
      },
      "DocumentListResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer",
            "description": "Número total de documentos"
          },
          "next": {
            "type": "string",
            "nullable": true,
            "description": "URL de la siguiente página"
          },
          "previous": {
            "type": "string",
            "nullable": true,
            "description": "URL de la página anterior"
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DocumentDetail"
            }
          }
        }
      },
      "DocumentDetail": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID único del documento"
          },
          "folio": {
            "type": "string",
            "description": "Número de folio del documento",
            "nullable": true
          },
          "date_issued": {
            "type": "string",
            "format": "date",
            "description": "Fecha de emisión del documento"
          },
          "amount_with_iva": {
            "type": "number",
            "format": "float",
            "description": "Monto total con IVA"
          },
          "dte_type_code": {
            "type": "string",
            "description": "Código del tipo de DTE (ej: \"33\" para Factura Electrónica)"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha de creación del registro (ISO 8601)"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha de última actualización (ISO 8601)"
          }
        }
      },
      "DocumentDetailWithFiles": {
        "type": "object",
        "allOf": [
          {
            "$ref": "#/components/schemas/DocumentDetail"
          },
          {
            "type": "object",
            "properties": {
              "amount_iva": {
                "type": "number",
                "format": "float",
                "description": "Monto del IVA",
                "nullable": true
              },
              "amount_without_iva": {
                "type": "number",
                "format": "float",
                "description": "Monto sin IVA",
                "nullable": true
              },
              "currency": {
                "type": "string",
                "description": "Moneda del documento",
                "enum": [
                  "CLP",
                  "UF",
                  "USD",
                  "EUR"
                ],
                "example": "CLP"
              },
              "sender_id": {
                "type": "integer",
                "description": "ID de la entidad emisora"
              },
              "sender_name": {
                "type": "string",
                "description": "Nombre de la entidad emisora"
              },
              "sender_tax_id": {
                "type": "string",
                "description": "RUT de la entidad emisora"
              },
              "receiver_id": {
                "type": "string",
                "description": "ID de la entidad receptora (como string, puede ser null para algunos tipos de documentos)",
                "nullable": true
              },
              "receiver_name": {
                "type": "string",
                "description": "Nombre de la entidad receptora",
                "nullable": true
              },
              "receiver_tax_id": {
                "type": "string",
                "description": "RUT de la entidad receptora",
                "nullable": true
              },
              "has_credit_note": {
                "type": "boolean",
                "description": "Indica si el documento tiene una nota de crédito asociada"
              },
              "is_paid": {
                "type": "boolean",
                "description": "Indica si el documento está marcado como pagado"
              },
              "json_param": {
                "type": "object",
                "additionalProperties": true,
                "description": "Parámetros JSON almacenados del documento",
                "nullable": true
              },
              "traces": {
                "type": "array",
                "description": "Array de trazas de envío al SII",
                "items": {
                  "type": "object"
                }
              },
              "trace_update_log": {
                "type": "object",
                "description": "Log de actualización de trazas",
                "nullable": true
              },
              "document_states": {
                "type": "array",
                "description": "Array de estados del documento (rechazado, con NC, acuse, pagado, mérito ejecutivo)",
                "items": {
                  "type": "object",
                  "properties": {
                    "label": {
                      "type": "string",
                      "description": "Etiqueta del estado"
                    },
                    "description": {
                      "type": "string"
                    },
                    "state_type": {
                      "type": "string",
                      "description": "Tipo de estado del documento"
                    }
                  }
                }
              },
              "vat_withheld": {
                "type": "boolean",
                "description": "Indica si se retuvo IVA",
                "nullable": true
              },
              "exchange_rate": {
                "type": "string",
                "description": "Tipo de cambio para facturas internacionales",
                "nullable": true
              },
              "original_amount": {
                "type": "string",
                "description": "Monto original en moneda extranjera para facturas internacionales",
                "nullable": true
              },
              "state": {
                "type": "string",
                "description": "Estado del documento (draft, issued, etc.)",
                "nullable": true
              },
              "dte_type_description": {
                "type": "string",
                "description": "Descripción del tipo de DTE"
              },
              "pdf": {
                "type": "string",
                "format": "uri",
                "description": "URL presignada al PDF del documento (válida por tiempo limitado, generalmente 1 hora)",
                "nullable": true
              },
              "xml": {
                "type": "string",
                "description": "Contenido completo del XML del documento tributario electrónico",
                "nullable": true
              },
              "xml_error": {
                "type": "string",
                "description": "Mensaje de error si no se pudo obtener el XML (null si está disponible)",
                "nullable": true
              },
              "has_trace": {
                "type": "boolean",
                "description": "true si el documento tiene trazas de envío al SII, false en caso contrario"
              },
              "latest_trace_info": {
                "type": "object",
                "description": "Información de la última traza disponible (estado de envío, fecha, etc.)",
                "nullable": true,
                "properties": {
                  "status": {
                    "type": "string",
                    "description": "Estado de la traza",
                    "example": "accepted"
                  },
                  "timestamp": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Fecha y hora de la traza",
                    "example": "2024-01-15T10:35:00Z"
                  },
                  "description": {
                    "type": "string",
                    "example": "Documento aceptado por el SII"
                  }
                }
              },
              "references": {
                "type": "array",
                "description": "Array de documentos referenciados (para notas de crédito, etc.)",
                "items": {
                  "$ref": "#/components/schemas/ReferenceItem"
                }
              },
              "details": {
                "type": "array",
                "description": "Array de productos/líneas del documento",
                "items": {
                  "$ref": "#/components/schemas/DetailItem"
                },
                "nullable": true
              },
              "header": {
                "$ref": "#/components/schemas/DocumentHeader",
                "description": "Información del encabezado del documento (transacción, pago, etc.)",
                "nullable": true
              },
              "document_issuer": {
                "$ref": "#/components/schemas/DocumentIssuer",
                "description": "Información completa del emisor del documento",
                "nullable": true
              },
              "document_receiver": {
                "$ref": "#/components/schemas/DocumentReceiver",
                "description": "Información completa del receptor del documento",
                "nullable": true
              }
            }
          }
        ]
      },
      "Error": {
        "required": [
          "error",
          "message"
        ],
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Código de error",
            "example": "VALIDATION_ERROR",
            "enum": [
              "VALIDATION_ERROR",
              "AUTHENTICATION_ERROR",
              "AUTHORIZATION_ERROR",
              "NOT_FOUND",
              "SII_ERROR",
              "INTERNAL_ERROR"
            ]
          },
          "message": {
            "type": "string",
            "description": "Mensaje de error"
          }
        }
      },
      "MasterEntity": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID único de la entidad maestra",
            "example": 371
          },
          "tax_id": {
            "type": "string",
            "description": "RUT de la entidad maestra",
            "example": "76.798.398-0"
          },
          "name": {
            "type": "string",
            "description": "Razón social de la entidad",
            "example": "SUPLO SPA"
          },
          "email": {
            "type": "string",
            "description": "Correo electrónico de contacto",
            "nullable": true,
            "example": null
          },
          "addresses": {
            "type": "array",
            "description": "Lista de direcciones de la entidad",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "description": "ID único de la dirección",
                  "example": 6
                },
                "address": {
                  "type": "string",
                  "description": "Dirección completa",
                  "example": "AV TAJAMAR 183 OF 401   OFIC"
                },
                "district": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer",
                      "description": "ID único de la comuna",
                      "example": 7
                    },
                    "name": {
                      "type": "string",
                      "description": "Nombre de la comuna",
                      "example": "LAS CONDES"
                    },
                    "city": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "description": "ID único de la ciudad",
                          "example": 3
                        },
                        "name": {
                          "type": "string",
                          "description": "Nombre de la ciudad",
                          "example": "SANTIAGO"
                        }
                      }
                    }
                  }
                },
                "sii_branch_code": {
                  "type": "string",
                  "description": "Código de sucursal SII",
                  "nullable": true,
                  "example": null
                },
                "phone": {
                  "type": "string",
                  "description": "Teléfono de la sucursal",
                  "nullable": true,
                  "example": null
                }
              }
            }
          },
          "activities": {
            "type": "array",
            "description": "Lista de actividades económicas de la entidad",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "description": "ID único de la actividad",
                  "example": 1
                },
                "code": {
                  "type": "string",
                  "description": "Código de actividad económica",
                  "example": "620900"
                },
                "name": {
                  "type": "string",
                  "description": "Nombre de la actividad económica",
                  "example": "OTRAS ACTIVIDADES DE TECNOLOGIA DE LA IN"
                }
              }
            }
          }
        }
      },
      "ScheduledDocumentReferenceItem": {
        "type": "object",
        "description": "Referencia a un documento (ej. para notas de crédito). Máximo 3 referencias por documento programado.",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID de la referencia (solo en respuesta)",
            "example": 1
          },
          "dte_type_code": {
            "type": "string",
            "description": "Código del tipo de DTE del documento referenciado (ej: 33, 61)",
            "example": "33"
          },
          "reference_folio": {
            "type": "string",
            "description": "Folio del documento referenciado",
            "example": "123"
          },
          "reference_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha del documento referenciado (YYYY-MM-DD)",
            "example": "2024-01-15"
          },
          "reference_reason": {
            "type": "string",
            "description": "Razón de la referencia. Para notas de crédito totales: 'ANULA DOCUMENTO DE LA REFERENCIA'.",
            "nullable": true,
            "example": "ANULA DOCUMENTO DE LA REFERENCIA"
          }
        }
      },
      "ScheduledDocumentListResponse": {
        "type": "object",
        "properties": {
          "count": {
            "type": "integer",
            "description": "Total de documentos programados",
            "example": 25
          },
          "next": {
            "type": "string",
            "nullable": true,
            "description": "URL de la siguiente página",
            "example": "https://api.tupana.ai/v1/scheduled-documents?master_entity_id=123&page=2"
          },
          "previous": {
            "type": "string",
            "nullable": true,
            "description": "URL de la página anterior",
            "example": null
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ScheduledDocument"
            }
          }
        }
      },
      "ScheduledDocument": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID único del documento programado",
            "example": 789
          },
          "sender": {
            "type": "object",
            "description": "Información de la entidad emisora",
            "properties": {
              "id": {
                "type": "integer",
                "example": 123
              },
              "name": {
                "type": "string",
                "example": "Empresa Ejemplo SpA"
              },
              "rut": {
                "type": "string",
                "example": "76543210-1"
              }
            }
          },
          "receiver": {
            "type": "object",
            "nullable": true,
            "description": "Información de la entidad receptora",
            "properties": {
              "id": {
                "type": "integer",
                "example": 456
              },
              "name": {
                "type": "string",
                "example": "Cliente ABC Ltda"
              },
              "rut": {
                "type": "string",
                "example": "12345678-9"
              }
            }
          },
          "dte_type": {
            "type": "object",
            "description": "Tipo de documento tributario",
            "properties": {
              "id": {
                "type": "integer",
                "example": 1
              },
              "code": {
                "type": "string",
                "example": "33"
              },
              "description": {
                "type": "string",
                "example": "Factura Electrónica"
              }
            }
          },
          "frequency": {
            "type": "string",
            "enum": [
              "daily",
              "weekly",
              "monthly",
              "quarterly",
              "semiannual",
              "yearly"
            ],
            "description": "Frecuencia de ejecución",
            "example": "monthly"
          },
          "frequency_display": {
            "type": "string",
            "description": "Frecuencia en formato legible",
            "example": "Mensual"
          },
          "day_of_month": {
            "type": "integer",
            "nullable": true,
            "description": "Día del mes en que se ejecutará el documento (1-31). Requerido para frecuencias: monthly, quarterly, semiannual, yearly. Si el día no existe en un mes (ej: 31 en febrero), se usará el último día del mes.",
            "example": 15
          },
          "day_of_week": {
            "type": "integer",
            "nullable": true,
            "description": "Día de la semana para ejecución (1=Lunes, 7=Domingo)",
            "example": null
          },
          "next_execution": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha y hora de la próxima ejecución",
            "example": "2024-02-15T10:00:00Z"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive",
              "completed"
            ],
            "description": "Estado del documento programado",
            "example": "active"
          },
          "status_display": {
            "type": "string",
            "description": "Estado en formato legible",
            "example": "Activo"
          },
          "amount": {
            "type": "number",
            "description": "Monto del documento",
            "example": 100000
          },
          "currency": {
            "type": "string",
            "enum": [
              "CLP",
              "UF",
              "USD",
              "EUR"
            ],
            "description": "Moneda del documento",
            "example": "CLP"
          },
          "currency_day": {
            "type": "integer",
            "nullable": true,
            "minimum": 1,
            "maximum": 31,
            "description": "Día del mes (1-31) para tomar el valor del tipo de cambio. Aplica cuando la moneda es UF o USD; si no se indica, se usa el día de emisión.",
            "example": 10
          },
          "completed_occurrences": {
            "type": "integer",
            "description": "Número de veces que se ha ejecutado",
            "example": 5
          },
          "max_occurrences": {
            "type": "integer",
            "nullable": true,
            "description": "Número máximo de ejecuciones",
            "example": null
          },
          "start_date": {
            "type": "string",
            "format": "date",
            "nullable": true,
            "description": "Fecha de inicio de la programación (YYYY-MM-DD). Define desde cuándo comenzará a ejecutarse el documento programado. Si no se proporciona, se usa la fecha actual. La primera ejecución será calculada a partir de esta fecha según la frecuencia configurada.",
            "example": "2024-02-01"
          },
          "emission_day_adjustment": {
            "type": "string",
            "enum": [
              "none",
              "next",
              "previous"
            ],
            "description": "Ajuste de fecha de emisión a días hábiles: 'none' (sin ajuste), 'next' (próximo día hábil), 'previous' (anterior día hábil)",
            "default": "none",
            "example": "none"
          },
          "end_type": {
            "type": "string",
            "enum": [
              "never",
              "on_date",
              "after_occurrences"
            ],
            "description": "Tipo de finalización de la programación: 'never' (nunca finaliza, se ejecuta indefinidamente), 'on_date' (finaliza en una fecha específica, requiere end_date), 'after_occurrences' (finaliza después de un número máximo de ejecuciones, requiere max_occurrences). Por defecto: 'never'.",
            "default": "never",
            "example": "never"
          },
          "end_date": {
            "type": "string",
            "format": "date",
            "nullable": true,
            "description": "Fecha de finalización de la programación (YYYY-MM-DD). Solo aplica y es requerido si end_type es 'on_date'. El documento programado dejará de ejecutarse después de esta fecha.",
            "example": "2024-12-31"
          },
          "details": {
            "type": "array",
            "description": "Detalles/productos del documento",
            "items": {
              "$ref": "#/components/schemas/ScheduledDocumentDetail"
            }
          },
          "references": {
            "type": "array",
            "maxItems": 3,
            "description": "Referencias a documentos (ej. factura anulada por nota de crédito). Máximo 3 referencias.",
            "items": {
              "$ref": "#/components/schemas/ScheduledDocumentReferenceItem"
            }
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha de creación",
            "example": "2024-01-15T10:00:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha de última actualización",
            "example": "2024-01-20T15:30:00Z"
          }
        }
      },
      "ScheduledDocumentCreate": {
        "type": "object",
        "required": [
          "sender",
          "dte_type",
          "frequency",
          "details",
          "receiver_tax_id"
        ],
        "properties": {
          "sender": {
            "type": "integer",
            "description": "ID de la entidad maestra emisora (obligatorio)",
            "example": 123
          },
          "dte_type": {
            "type": "string",
            "description": "Código del tipo de DTE (ej: '33' para Factura Electrónica)",
            "example": "33"
          },
          "receiver_tax_id": {
            "type": "string",
            "description": "RUT del receptor (formato: 12345678-9). El sistema buscará un cliente existente con este RUT. Si no existe, creará uno nuevo automáticamente. Campo requerido.",
            "example": "12345678-9"
          },
          "frequency": {
            "type": "string",
            "enum": [
              "daily",
              "weekly",
              "monthly",
              "quarterly",
              "semiannual",
              "yearly"
            ],
            "description": "Frecuencia de ejecución del documento programado. Valores: 'daily' (diario), 'weekly' (semanal), 'monthly' (mensual), 'quarterly' (trimestral), 'semiannual' (semestral), 'yearly' (anual).",
            "example": "monthly"
          },
          "day_of_month": {
            "type": "integer",
            "description": "Día del mes en que se ejecutará el documento (1-31). Requerido para frecuencias: monthly, quarterly, semiannual, yearly. Si el día no existe en un mes (ej: 31 en febrero), se usará el último día del mes.",
            "minimum": 1,
            "maximum": 31,
            "example": 15
          },
          "day_of_week": {
            "type": "integer",
            "description": "Día de la semana en que se ejecutará el documento (1=Lunes, 2=Martes, 3=Miércoles, 4=Jueves, 5=Viernes, 6=Sábado, 7=Domingo). Requerido para frecuencia semanal (weekly).",
            "minimum": 1,
            "maximum": 7,
            "example": 1
          },
          "start_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de inicio de la programación (YYYY-MM-DD). Define desde cuándo comenzará a ejecutarse el documento programado. Si no se proporciona, se usa la fecha actual. La primera ejecución será calculada a partir de esta fecha según la frecuencia configurada.",
            "example": "2024-02-01"
          },
          "emission_day_adjustment": {
            "type": "string",
            "enum": [
              "none",
              "next",
              "previous"
            ],
            "description": "Ajuste de fecha de emisión a días hábiles. Si la fecha calculada cae en fin de semana o feriado, se ajusta según esta opción: 'none' (sin ajuste, emite en la fecha calculada aunque sea fin de semana), 'next' (ajusta al próximo día hábil), 'previous' (ajusta al anterior día hábil). Por defecto: 'none'.",
            "default": "none",
            "example": "none"
          },
          "end_type": {
            "type": "string",
            "enum": [
              "never",
              "on_date",
              "after_occurrences"
            ],
            "description": "Tipo de finalización de la programación: 'never' (nunca finaliza, se ejecuta indefinidamente), 'on_date' (finaliza en una fecha específica, requiere end_date), 'after_occurrences' (finaliza después de un número máximo de ejecuciones, requiere max_occurrences). Por defecto: 'never'.",
            "default": "never",
            "example": "never"
          },
          "end_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de finalización de la programación (YYYY-MM-DD). Solo aplica y es requerido si end_type es 'on_date'. El documento programado dejará de ejecutarse después de esta fecha.",
            "example": "2024-12-31"
          },
          "currency": {
            "type": "string",
            "description": "Moneda del documento",
            "enum": [
              "CLP",
              "UF",
              "USD",
              "EUR"
            ],
            "default": "CLP",
            "example": "CLP"
          },
          "currency_day": {
            "type": "integer",
            "nullable": true,
            "minimum": 1,
            "maximum": 31,
            "description": "Día del mes (1-31) para tomar el valor del tipo de cambio (UF o USD). Si no se indica, se usa el día de emisión.",
            "example": 10
          },
          "references": {
            "type": "array",
            "maxItems": 3,
            "description": "Referencias a documentos (ej. factura anulada por nota de crédito). Máximo 3 referencias.",
            "items": {
              "$ref": "#/components/schemas/ScheduledDocumentReferenceItem"
            }
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ],
            "description": "Estado inicial del documento programado",
            "default": "active",
            "example": "active"
          },
          "max_occurrences": {
            "type": "integer",
            "description": "Número máximo de ejecuciones (opcional, null = infinito). Solo aplica si end_type es 'after_occurrences'.",
            "minimum": 1,
            "example": 12
          },
          "details": {
            "type": "array",
            "description": "Detalles/productos del documento",
            "minItems": 1,
            "items": {
              "$ref": "#/components/schemas/ScheduledDocumentDetailCreate"
            }
          }
        }
      },
      "ScheduledDocumentUpdate": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "active",
              "inactive"
            ],
            "description": "Estado del documento programado",
            "example": "inactive"
          },
          "amount": {
            "type": "number",
            "description": "Monto total del documento",
            "minimum": 0,
            "example": 120000
          },
          "frequency": {
            "type": "string",
            "enum": [
              "daily",
              "weekly",
              "monthly",
              "quarterly",
              "semiannual",
              "yearly"
            ],
            "description": "Frecuencia de ejecución del documento programado. Valores: 'daily' (diario), 'weekly' (semanal), 'monthly' (mensual), 'quarterly' (trimestral), 'semiannual' (semestral), 'yearly' (anual).",
            "example": "weekly"
          },
          "day_of_month": {
            "type": "integer",
            "description": "Día del mes en que se ejecutará el documento (1-31). Requerido para frecuencias: monthly, quarterly, semiannual, yearly. Si el día no existe en un mes (ej: 31 en febrero), se usará el último día del mes.",
            "minimum": 1,
            "maximum": 31,
            "example": 20
          },
          "day_of_week": {
            "type": "integer",
            "description": "Día de la semana en que se ejecutará el documento (1=Lunes, 2=Martes, 3=Miércoles, 4=Jueves, 5=Viernes, 6=Sábado, 7=Domingo). Requerido para frecuencia semanal (weekly).",
            "minimum": 1,
            "maximum": 7,
            "example": 2
          },
          "start_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de inicio de la programación (YYYY-MM-DD). Define desde cuándo comenzará a ejecutarse el documento programado. La primera ejecución será calculada a partir de esta fecha según la frecuencia configurada.",
            "example": "2024-02-01"
          },
          "emission_day_adjustment": {
            "type": "string",
            "enum": [
              "none",
              "next",
              "previous"
            ],
            "description": "Ajuste de fecha de emisión a días hábiles. Si la fecha calculada cae en fin de semana o feriado, se ajusta según esta opción: 'none' (sin ajuste, emite en la fecha calculada aunque sea fin de semana), 'next' (ajusta al próximo día hábil), 'previous' (ajusta al anterior día hábil).",
            "example": "none"
          },
          "end_type": {
            "type": "string",
            "enum": [
              "never",
              "on_date",
              "after_occurrences"
            ],
            "description": "Tipo de finalización de la programación: 'never' (nunca finaliza, se ejecuta indefinidamente), 'on_date' (finaliza en una fecha específica, requiere end_date), 'after_occurrences' (finaliza después de un número máximo de ejecuciones, requiere max_occurrences).",
            "example": "never"
          },
          "end_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de finalización de la programación (YYYY-MM-DD). Solo aplica y es requerido si end_type es 'on_date'. El documento programado dejará de ejecutarse después de esta fecha.",
            "example": "2024-12-31"
          },
          "max_occurrences": {
            "type": "integer",
            "nullable": true,
            "description": "Número máximo de ejecuciones. Solo aplica y es requerido si end_type es 'after_occurrences'. El documento programado dejará de ejecutarse después de alcanzar este número de ejecuciones.",
            "minimum": 1,
            "example": 24
          },
          "currency_day": {
            "type": "integer",
            "nullable": true,
            "minimum": 1,
            "maximum": 31,
            "description": "Día del mes (1-31) para tomar el valor del tipo de cambio (UF o USD). Si no se indica, se usa el día de emisión.",
            "example": 10
          },
          "references": {
            "type": "array",
            "maxItems": 3,
            "description": "Referencias a documentos (ej. factura anulada por nota de crédito). Máximo 3 referencias. Si se envía, reemplaza todas las referencias existentes.",
            "items": {
              "$ref": "#/components/schemas/ScheduledDocumentReferenceItem"
            }
          }
        }
      },
      "ScheduledDocumentDetail": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID único del detalle",
            "example": 1
          },
          "item_name": {
            "type": "string",
            "description": "Nombre del producto o servicio",
            "example": "Servicio mensual de consultoría"
          },
          "description": {
            "type": "string",
            "example": "Consultoría especializada en tecnología"
          },
          "quantity": {
            "type": "number",
            "description": "Cantidad",
            "example": 1
          },
          "unit_price": {
            "type": "number",
            "description": "Precio unitario",
            "example": 100000
          },
          "total": {
            "type": "number",
            "description": "Total de la línea",
            "example": 100000
          },
          "unit_of_measurement": {
            "type": "string",
            "description": "Unidad de medida",
            "example": "UN"
          },
          "item_code": {
            "type": "string",
            "description": "Código del producto o servicio según el sistema del emisor. Este código aparece en el documento emitido y puede ser usado para identificación interna del producto.",
            "nullable": true,
            "example": "PROD-001"
          },
          "item_type_code": {
            "type": "string",
            "description": "Código de tipo de ítem según clasificación SII. Identifica la categoría del producto o servicio (ej: '1' para productos, '2' para servicios).",
            "nullable": true,
            "example": "1"
          }
        }
      },
      "ExportData": {
        "type": "object",
        "description": "Datos específicos para facturas de exportación (DTE 110) y notas de crédito de exportación (DTE 112). Solo requerido cuando se selecciona uno de estos tipos de documento.",
        "properties": {
          "tax_id_receptor": {
            "type": "string",
            "description": "Identificación tributaria del receptor en el país de destino"
          },
          "destination_country_code": {
            "type": "string",
            "description": "Código del país de destino (ISO 3166-1 alpha-2)",
            "example": "US"
          },
          "currency_code": {
            "type": "string",
            "description": "Código de la moneda (ISO 4217)",
            "example": "USD"
          },
          "exchange_rate": {
            "type": "string",
            "description": "Tipo de cambio aplicado",
            "example": "800.50"
          },
          "departure_port_code": {
            "type": "string",
            "description": "Código del puerto de embarque"
          },
          "arrival_port_code": {
            "type": "string",
            "description": "Código del puerto de desembarque"
          },
          "departure_port_name": {
            "type": "string",
            "description": "Nombre del puerto de embarque"
          },
          "arrival_port_name": {
            "type": "string",
            "description": "Nombre del puerto de desembarque"
          },
          "total_packages": {
            "type": "string",
            "description": "Número total de bultos"
          },
          "sale_mode_code": {
            "type": "string",
            "description": "Código de modalidad de venta"
          },
          "export_type": {
            "type": "string",
            "description": "Tipo de exportación",
            "default": "0"
          }
        }
      },
      "ScheduledDocumentDetailCreate": {
        "type": "object",
        "required": [
          "item_name",
          "quantity",
          "unit_price"
        ],
        "properties": {
          "item_name": {
            "type": "string",
            "description": "Nombre del producto o servicio",
            "example": "Servicio mensual de consultoría"
          },
          "description": {
            "type": "string",
            "example": "Consultoría especializada en tecnología"
          },
          "quantity": {
            "type": "number",
            "description": "Cantidad",
            "minimum": 0.01,
            "example": 1
          },
          "unit_price": {
            "type": "number",
            "description": "Precio unitario",
            "minimum": 0,
            "example": 100000
          },
          "unit_of_measurement": {
            "type": "string",
            "description": "Unidad de medida",
            "default": "UN",
            "example": "UN"
          },
          "item_code": {
            "type": "string",
            "description": "Código del ítem",
            "nullable": true,
            "example": "PROD-001"
          },
          "item_type_code": {
            "type": "string",
            "description": "Código de tipo de ítem",
            "nullable": true,
            "example": "1"
          }
        }
      }
    },
    "securitySchemes": {
      "apiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "API Key para autenticación. Debe proporcionarse en el header Authorization con el formato: 'Api-Key YOUR-API-KEY' (incluye el prefijo 'Api-Key ' seguido de tu API key)"
      }
    }
  }
}