---
title: 'Emisi√≥n masiva de documentos'
openapi: 'POST /documents/batch'
---

Crea hasta 200 documentos tributarios electr√≥nicos en una sola llamada. La respuesta con el PDF y los detalles completos se entrega a trav√©s del [webhook configurado](/user-guide/getting-started#paso-4%3A-configura-las-notificaciones-webhooks/).

## Headers

### Idempotency-Key (Opcional)
- **Tipo:** String
- **Descripci√≥n:** Header opcional que previene la creaci√≥n de lotes duplicados
- **Restricciones:** M√°ximo 256 caracteres, expira despu√©s de 24 horas
- **Ejemplo:** `"batch_2024_01_15_001"`

### X-Use-Defaults (Opcional)

> **‚ö†Ô∏è IMPORTANTE: Se recomienda encarecidamente usar el header `X-Use-Defaults: true` en todas tus solicitudes de emisi√≥n masiva de documentos.** Este header simplifica significativamente la creaci√≥n de documentos al hacer opcionales muchos campos y completar autom√°ticamente los datos faltantes seg√∫n tu configuraci√≥n en Tu Pana.

- **Tipo:** String
- **Valores permitidos:** `"true"`, `"false"`
- **Por defecto:** `"false"`
- **Descripci√≥n:** Si se establece como `"true"`, el sistema usar√° valores por defecto para campos no proporcionados, reduciendo la complejidad y cantidad de datos que necesitas enviar

#### Campos que se vuelven opcionales o se completan autom√°ticamente

**A nivel del documento:**
- `date_issued`: Si no se proporciona, se usa la fecha actual (en zona horaria de Chile)
- `folio`: Si no se proporciona, se genera autom√°ticamente por el sistema
- `dte_type.code`: Si no se proporciona, se usa `"33"` (Factura Electr√≥nica) por defecto
- `header.payment_method`: Si no se proporciona, se establece como `"2"` (cr√©dito)

**En `document_issuer` (solo con RUT):**
Con `X-Use-Defaults: true`, solo necesitas proporcionar el `rut` del emisor. El sistema completa autom√°ticamente todos los dem√°s campos desde tu configuraci√≥n:
- `business_name`: Raz√≥n social del emisor
- `business_activity`: Giro o actividad econ√≥mica
- `address`: Direcci√≥n del emisor
- `district`: Comuna
- `city`: Ciudad
- `email`: Email de contacto
- `phone_number`: Tel√©fono
- `activity_code`: C√≥digo de actividad econ√≥mica

**En `document_receiver` (solo con RUT):**
Con `X-Use-Defaults: true`, solo necesitas proporcionar el `rut` del receptor. El sistema completa autom√°ticamente todos los dem√°s campos desde la configuraci√≥n del cliente o datos disponibles:
- `business_name`: Raz√≥n social del receptor ‚úÖ **Opcional**
- `contact`: Contacto del receptor ‚úÖ **Opcional**
- `business_activity`: Giro o actividad econ√≥mica ‚úÖ **Opcional** (no se valida si est√° vac√≠o)
- `address`: Direcci√≥n del receptor ‚úÖ **Opcional** (no se valida si est√° vac√≠o)
- `district`: Comuna ‚úÖ **Opcional** (no se valida si est√° vac√≠o)
- `city`: Ciudad ‚úÖ **Opcional** (no se valida si est√° vac√≠o)

## Request Body

### documents (Obligatorio)
- **Tipo:** Array
- **Descripci√≥n:** Lista de documentos a crear en el lote
- **Restricciones:** M√°ximo 200 documentos por lote

### Estructura de cada documento

#### Campos base (aplican a todos los tipos de documentos)

**dte_type (Obligatorio)**
- **Tipo:** Object
- **Campos:**
  - `code` (String): C√≥digo del tipo de documento

**date_issued (Condicional)**
- **Tipo:** String (formato YYYY-MM-DD)
- **Descripci√≥n:** Fecha de emisi√≥n del documento
- **Obligatorio:** S√≠, excepto si se usa `X-Use-Defaults: true` (usa fecha actual)

**folio (Opcional)**
- **Tipo:** Integer
- **Descripci√≥n:** N√∫mero de folio del documento
- **Comportamiento:** Si no se proporciona, se genera autom√°ticamente


## Tipos de Documentos Soportados

<details>
<summary><strong>üìÑ Factura Electr√≥nica (DTE 33)</strong> - Documento tributario m√°s com√∫n para ventas</summary>

**Campos espec√≠ficos:**

**document_issuer (Obligatorio)**
- **Tipo:** Object
- **Campos obligatorios:**
  - `rut` (String): RUT del emisor
  - `business_name` (String): Raz√≥n social - Opcional con `X-Use-Defaults: true`
  - `business_activity` (String): Giro o actividad econ√≥mica - Opcional con `X-Use-Defaults: true`
  - `address` (String): Direcci√≥n - Opcional con `X-Use-Defaults: true`
  - `district` (String): Comuna - Opcional con `X-Use-Defaults: true`
  - `city` (String): Ciudad - Opcional con `X-Use-Defaults: true`
  - `email` (String): Email de contacto - Opcional con `X-Use-Defaults: true`
  - `phone_number` (String): Tel√©fono - Opcional con `X-Use-Defaults: true`
  - `activity_code` (Integer): C√≥digo de actividad econ√≥mica - Opcional con `X-Use-Defaults: true`

**document_receiver (Obligatorio)**
- **Tipo:** Object
- **Campos obligatorios:**
  - `rut` (String): RUT del receptor
  - `business_name` (String): Raz√≥n social - Opcional con `X-Use-Defaults: true`
  - `business_activity` (String): Giro o actividad econ√≥mica - Opcional con `X-Use-Defaults: true`
  - `address` (String): Direcci√≥n - Opcional con `X-Use-Defaults: true`
  - `district` (String): Comuna - Opcional con `X-Use-Defaults: true`
  - `city` (String): Ciudad - Opcional con `X-Use-Defaults: true`

**details (Obligatorio)**
- **Tipo:** Array
- **Descripci√≥n:** Lista de productos/servicios del documento
- **Campos de cada elemento:**
  - `item_name` (String): Nombre del producto/servicio
  - `quantity` (Number): Cantidad (debe ser mayor a 0)
  - `unit_price` (Number): Precio unitario
  - `item_total` (Number): Total del √≠tem (debe ser igual a quantity √ó unit_price)

</details>

<details>
<summary><strong>üìÑ Factura Exenta (DTE 34)</strong> - Para ventas exentas de IVA</summary>

**Campos espec√≠ficos:**
Iguales a la Factura Electr√≥nica (DTE 33), pero el documento no incluye IVA en los c√°lculos.

**Casos de uso:**
- Ventas a clientes exentos de IVA
- Exportaciones (aunque se recomienda usar DTE espec√≠fico de exportaci√≥n)
- Servicios espec√≠ficos exentos por ley

**document_issuer y document_receiver:** Mismos campos que Factura Electr√≥nica
**details:** Mismos campos que Factura Electr√≥nica

</details>

<details>
<summary><strong>üßæ Factura de Compra (DTE 46)</strong> - Para registro de compras realizadas</summary>

**Campos espec√≠ficos:**

**document_issuer (Obligatorio)**
- **Tipo:** Object
- **Descripci√≥n:** Datos del proveedor/vendedor
- **Campos obligatorios:**
  - `rut` (String): RUT del proveedor
  - `business_name` (String): Raz√≥n social del proveedor - Opcional con `X-Use-Defaults: true`
  - `business_activity` (String): Giro del proveedor - Opcional con `X-Use-Defaults: true`
  - `address` (String): Direcci√≥n del proveedor - Opcional con `X-Use-Defaults: true`
  - `district` (String): Comuna del proveedor - Opcional con `X-Use-Defaults: true`
  - `city` (String): Ciudad del proveedor - Opcional con `X-Use-Defaults: true`

**document_receiver (Obligatorio)**
- **Tipo:** Object
- **Descripci√≥n:** Datos del comprador (tu empresa)
- **Campos obligatorios:**
  - `rut` (String): RUT de tu empresa
  - `business_name` (String): Raz√≥n social - Opcional con `X-Use-Defaults: true`
  - `business_activity` (String): Giro - Opcional con `X-Use-Defaults: true`
  - `address` (String): Direcci√≥n - Opcional con `X-Use-Defaults: true`
  - `district` (String): Comuna - Opcional con `X-Use-Defaults: true`
  - `city` (String): Ciudad - Opcional con `X-Use-Defaults: true`

**details (Obligatorio)**
- **Tipo:** Array
- **Descripci√≥n:** Lista de productos/servicios comprados
- **Campos de cada elemento:**
  - `item_name` (String): Nombre del producto/servicio comprado
  - `quantity` (Number): Cantidad comprada
  - `unit_price` (Number): Precio unitario pagado
  - `item_total` (Number): Total del √≠tem

**header (Obligatorio para ciertos casos)**
- **Tipo:** Object
- **Campos opcionales:**
  - `purchase_transaction_type` (Integer): **Obligatorio para compras** - Clasifica el tipo de compra para efectos contables y tributarios
    - `1`: **Compras del giro** - Productos/servicios directamente relacionados con tu actividad econ√≥mica principal (ej: materias primas para fabricante)
    - `2`: **Compras fuera del giro** - Productos/servicios no relacionados con tu giro (ej: √∫tiles de oficina para una f√°brica)
    - `3`: **Activo fijo** - Bienes que se incorporan al patrimonio y se deprecian (ej: maquinaria, veh√≠culos, muebles)
  - `payment_method` (String): **Opcional** - Forma de pago acordada
    - `"1"`: **Contado** - Pago inmediato al recibir la mercader√≠a/servicio
    - `"2"`: **Cr√©dito** - Pago diferido (especificar plazo en `due_date`)
    - `"3"`: **Sin costo** - Mercader√≠a/servicio recibido gratuitamente (donaci√≥n, regalo)
  - `due_date` (String): **Condicional** - Fecha de vencimiento cuando `payment_method` es cr√©dito
    - Formato: `YYYY-MM-DD`
    - Obligatorio cuando es compra a cr√©dito

</details>

<details>
<summary><strong>‚úàÔ∏è Factura de Exportaci√≥n (DTE 110)</strong> - Para ventas al extranjero</summary>

**Campos espec√≠ficos:**

**document_issuer (Obligatorio)**
- **Tipo:** Object
- **Campos obligatorios:**
  - `rut` (String): RUT del exportador
  - `business_name` (String): Raz√≥n social - Opcional con `X-Use-Defaults: true`
  - `business_activity` (String): Giro - Opcional con `X-Use-Defaults: true`
  - `address` (String): Direcci√≥n - Opcional con `X-Use-Defaults: true`
  - `district` (String): Comuna - Opcional con `X-Use-Defaults: true`
  - `city` (String): Ciudad - Opcional con `X-Use-Defaults: true`
  - `email` (String): Email de contacto - Opcional con `X-Use-Defaults: true`
  - `phone_number` (String): Tel√©fono - Opcional con `X-Use-Defaults: true`
  - `activity_code` (Integer): C√≥digo de actividad econ√≥mica - Opcional con `X-Use-Defaults: true`

**document_receiver (Obligatorio)**
- **Tipo:** Object
- **Descripci√≥n:** Datos del importador extranjero
- **Campos obligatorios:**
  - `rut` (String): RUT extranjero (puede ser un identificador especial)
  - `business_name` (String): Nombre del importador
  - `business_activity` (String): Descripci√≥n de la actividad
  - `address` (String): Direcci√≥n en el extranjero
  - `city` (String): Ciudad del extranjero
  - `country` (String): Pa√≠s de destino

**export_data (Obligatorio)**
- **Tipo:** Object
- **Descripci√≥n:** Informaci√≥n detallada de la exportaci√≥n requerida por aduanas y SII
- **Campos obligatorios:**

  - `transport_mode` (String): **Modalidad de transporte utilizada**
    - `"1"`: **Mar√≠timo** - Env√≠o por barco (contenedor, carga suelta)
    - `"2"`: **A√©reo** - Env√≠o por avi√≥n (carga a√©rea, courier)
    - `"3"`: **Terrestre** - Env√≠o por tierra (cami√≥n, ferrocarril, terrestre internacional)
    - `"4"`: **Multimodal** - Combinaci√≥n de dos o m√°s modos de transporte

  - `destination_country` (String): **Pa√≠s de destino final**
    - C√≥digo ISO de 2 letras (ej: `"US"`, `"BR"`, `"AR"`, `"MX"`)
    - Debe coincidir exactamente con el pa√≠s del receptor extranjero
    - Afecta tratados comerciales y aranceles

  - `destination_port` (String): **Puerto/aeropuerto/ciudad de destino**
    - Nombre oficial del punto de entrada (ej: `"JFK"`, `"Santos"`, `"Buenos Aires"`, `"Veracruz"`)
    - Para transporte terrestre: ciudad fronteriza de destino
    - Debe ser reconocible por autoridades aduaneras

  - `origin_port` (String): **Puerto/aeropuerto/ciudad de origen en Chile**
    - Punto chileno de salida (ej: `"SCL"`, `"IQQ"`, `"ANF"`, `"VAP"`)
    - Para transporte terrestre: ciudad fronteriza chilena
    - Determina jurisdicci√≥n aduanera chilena

  - `export_clause` (String): **Cl√°usula de exportaci√≥n** (condiciones del env√≠o)
    - `"1"`: **A firme** - Compromiso incondicional de exportar (venta confirmada)
    - `"2"`: **Bajo protesta** - Exportaci√≥n sujeta a condiciones o aprobaciones
    - `"3"`: **Sin cl√°usula** - Exportaci√≥n sin especificar condiciones especiales

- **Campos opcionales adicionales:**
  - `transport_company` (String): Nombre de la empresa de transporte
  - `tracking_number` (String): N√∫mero de seguimiento del env√≠o
  - `customs_declaration` (String): N√∫mero de declaraci√≥n aduanera (si aplica)

**details (Obligatorio)**
- **Tipo:** Array
- **Descripci√≥n:** Lista de productos exportados
- **Campos de cada elemento:**
  - `item_name` (String): Nombre del producto exportado
  - `quantity` (Number): Cantidad exportada
  - `unit_price` (Number): Precio unitario FOB (Free on Board)
  - `item_total` (Number): Total FOB del √≠tem

**header (Obligatorio)**
- **Tipo:** Object
- **Campos obligatorios:**
  - `sale_transaction_type` (Integer): Tipo de transacci√≥n de venta
    - `1`: Operaci√≥n constituye venta
    - `2`: Ventas por acto o contrato
    - `3`: Boleto de pasaje emitido por agencias
  - `currency` (String): Moneda de la transacci√≥n
    - `"USD"`: D√≥lares americanos
    - `"EUR"`: Euros
    - `"CLP"`: Pesos chilenos

</details>

<details>
<summary><strong>üìù Nota de Cr√©dito (DTE 61)</strong> - Para anular o corregir documentos emitidos</summary>

**Campos espec√≠ficos:**
Incluye todos los campos de las Facturas Electr√≥nicas m√°s:

**references (Obligatorio)**
- **Tipo:** Array
- **Descripci√≥n:** Referencias al documento que se anula o modifica
- **Campos de cada elemento:**
  - `dte_type_code` (String): C√≥digo del documento original (ej: "33", "34")
  - `reference_folio` (Integer): Folio del documento original
  - `reference_date` (String): Fecha del documento original (formato YYYY-MM-DD)
  - `reference_reason` (String): Raz√≥n de la referencia
    - Para anulaci√≥n total: `"ANULA DOCUMENTO DE LA REFERENCIA"`
    - Para correcci√≥n: Descripci√≥n del motivo de correcci√≥n

**Casos de uso:**
- Anulaci√≥n total de un documento
- Correcci√≥n de errores en documentos emitidos
- Descuentos o devoluciones

</details>

<details>
<summary><strong>üíº Boleta de Honorarios (DTE 80)</strong> - Para pagos de servicios profesionales</summary>

**Campos espec√≠ficos:**
Incluye todos los campos de las Facturas Electr√≥nicas con:

**header (Obligatorio)**
- **Tipo:** Object
- **Campos obligatorios:**
  - `retention_type` (String): **Tipo de retenci√≥n del 14.5%**
    - `"RETRECEPTOR"`: **Retenci√≥n por el receptor** (99% de casos) - El pagador retiene y declara el impuesto
    - `"RETCONTRIBUYENTE"`: **Retenci√≥n por el emisor** (casos excepcionales) - El emisor retiene el impuesto
  - `payment_method` (String): **Forma de pago** (opcional pero recomendado)
    - `"1"`: Contado
    - `"2"`: Cr√©dito
  - `due_date` (String): **Fecha de vencimiento** (opcional, formato YYYY-MM-DD)

**document_receiver (Condicional)**
- **Tipo:** Object
- **Descripci√≥n:** Datos del profesional que recibe los honorarios
- **Obligatoriedad:** Condicional - se puede usar solo RUT, pero se recomienda informaci√≥n completa
- **Campos:**
  - `rut` (String): **Obligatorio** - RUT del profesional
  - `business_name` (String): **Opcional** - Nombre completo del profesional
  - `business_activity` (String): **Opcional** - Profesi√≥n o especialidad (ej: "Abogado", "Contador", "M√©dico")
  - `address` (String): **Opcional** - Direcci√≥n del profesional
  - `district` (String): **Opcional** - Comuna del profesional
  - `city` (String): **Opcional** - Ciudad del profesional
  - `email` (String): **Opcional** - Email de contacto

**C√°lculo autom√°tico de retenci√≥n:**
- **Tasa**: 14.5% sobre el monto bruto (antes de IVA)
- **Base imponible**: Suma de todos los `item_total` en details
- **Retenci√≥n**: `base_imponible √ó 0.145`
- **Pago neto**: `base_imponible - retenci√≥n`
- **Responsable**: Normalmente el pagador declara y paga la retenci√≥n al SII

**Caracter√≠sticas especiales:**
- Aplica retenci√≥n del 14.5% sobre el monto bruto
- Se utiliza para pagos a profesionales independientes
- No requiere todos los datos del receptor obligatoriamente

</details>

<details>
<summary><strong>üè¢ Boleta de Honorarios de Terceros (DTE 90)</strong> - Para plataformas digitales</summary>

**Descripci√≥n:** Documento para que plataformas digitales emitan boletas de honorarios en nombre de terceros (contribuyentes reales). La estructura del request es **id√©ntica a DTE 80**; la diferencia est√° en el c√≥digo `dte_type.code: "90"`.

**C√≥digo DTE:** `"90"` ‚Äî Boleta de Honorarios a Terceros Electr√≥nica (confirmado en normativa SII).

---

### Requisito previo: agregar el contribuyente real (SII Company)

**Antes de emitir DTE 90, debes registrar el contribuyente real en Tu Pana:**

1. El `document_issuer.rut` debe corresponder a una **MasterEntity** ya existente en Tu Pana.
2. Esa entidad debe tener **credenciales SII de tipo `sii_company`** configuradas y activas.
3. La API usa el RUT de `document_issuer` para buscar la entidad emisora; si no existe o no tiene credenciales, la emisi√≥n falla.

**¬øQu√© es sii_company?** Es el tipo de credencial SII para empresas que emiten boletas de honorarios de terceros (a diferencia de credenciales personales). El contribuyente real (restaurante, empresa cliente) debe tener esta credencial en Tu Pana.

**Pasos para configurar:**
- Crear o importar la MasterEntity del contribuyente real (RUT, raz√≥n social, etc.).
- Configurar credenciales SII de tipo `sii_company` para esa entidad.
- Opcionalmente enrolar usuarios autorizados para emisi√≥n por terceros (ver [API de Honorarios](/api-reference/honorary/introduction)).

---

### X-Use-Defaults para DTE 90

**S√≠ se puede usar** `X-Use-Defaults: true`, pero con una limitaci√≥n importante:

- **document_issuer:** El sistema completa datos desde la MasterEntity que coincida con `document_issuer.rut`. Si el contribuyente real **no est√° registrado** en Tu Pana, X-Use-Defaults no podr√° completar datos y deber√°s enviar todos los campos obligatorios.
- **document_receiver:** Igual que DTE 80; si el RUT existe en Tu Pana, se completan datos.
- **date_issued, header.payment_method:** Se aplican los mismos defaults que para otros tipos.

**Recomendaci√≥n:** Si emites DTE 90 de forma recurrente, registra los contribuyentes reales (restaurantes, clientes) como MasterEntity en Tu Pana para poder usar X-Use-Defaults con solo el RUT.

---

### Campos requeridos (mismos que DTE 80)

**dte_type (Obligatorio)**
- `code` (String): `"90"` ‚Äî Boleta de Honorarios a Terceros Electr√≥nica

**document_issuer (Obligatorio)** ‚Äî Contribuyente real (el tercero en cuyo nombre emite la plataforma)
- **Tipo:** Object
- **Descripci√≥n:** Datos del contribuyente que paga los honorarios (restaurante, empresa cliente, etc.).
- **Campos obligatorios:**
  - `rut` (String): RUT del contribuyente real ‚Äî **debe existir como MasterEntity con credenciales sii_company**
  - `business_name` (String): Raz√≥n social del contribuyente real
  - `activity_code` (Integer): C√≥digo de actividad econ√≥mica (ej: 620900)
- **Con X-Use-Defaults:** Si el RUT existe en Tu Pana, los dem√°s campos se completan autom√°ticamente.

**document_receiver (Obligatorio)** ‚Äî Profesional que recibe los honorarios
- **Tipo:** Object
- **Campos obligatorios:** `rut` (String)
- **Opcionales:** `business_name`, `business_activity`, `address`, `district`, `city`, `contact`

**header (Obligatorio)**
- `retention_type` (String): `"RETRECEPTOR"` o `"RETCONTRIBUYENTE"`
- Opcionales: `payment_method`, `due_date`

**details (Obligatorio)**
- Array con `item_name`, `quantity`, `unit_price`, `item_total`

**Responsabilidades:**
- **Contribuyente real** (document_issuer): Debe estar en Tu Pana con credenciales sii_company; es el responsable tributario.
- **Retenci√≥n:** 14.5% sobre monto bruto, igual que DTE 80.

**Casos de uso:**
- Apps de delivery (Rappi, Uber Eats) ‚Äî restaurante paga al repartidor
- Plataformas freelance ‚Äî empresa paga al freelancer
- Marketplaces de servicios ‚Äî cliente paga al proveedor

</details>

## Respuesta

### Respuesta Inmediata de la API

#### 201 - Documentos creados exitosamente
- **Tipo:** Object
- **Campos:**
  - `batch_id` (String): Identificador √∫nico del lote
  - `status` (String): Estado del procesamiento (`"processing"`)
  - `total_documents` (Integer): N√∫mero total de documentos en el lote
  - `message` (String): Mensaje descriptivo del estado

#### 413 - L√≠mite excedido
- **Descripci√≥n:** M√°s de 200 documentos en el array
- **Campos:**
  - `error` (String): Descripci√≥n del error
  - `code` (String): C√≥digo de error

#### 400 - Credenciales no activas
- **Descripci√≥n:** La empresa emisora no tiene credenciales SII activas configuradas
- **Campos:**
  - `error` (String): Mensaje descriptivo indicando que no hay credenciales activas para el RUT especificado

#### 422 - Error de validaci√≥n
- **Descripci√≥n:** Cuerpo malformado o fallo de validaci√≥n
- **Campos:**
  - `error` (String): Descripci√≥n del error
  - `details` (Array): Detalles espec√≠ficos de los errores de validaci√≥n

### Respuesta del Webhook

Cuando un documento se emite exitosamente, Tu Pana env√≠a un webhook con la siguiente estructura:

**event (Obligatorio)**
- **Tipo:** String
- **Valor:** `"document.issued"`
- **Descripci√≥n:** Tipo de evento del webhook

**created_at (Obligatorio)**
- **Tipo:** String (ISO 8601)
- **Descripci√≥n:** Timestamp de cuando se gener√≥ el webhook

**data (Obligatorio)**
- **Tipo:** Object
- **Descripci√≥n:** Datos completos del documento emitido

#### Campos del objeto data

**Informaci√≥n b√°sica del documento:**
- `id` (Integer): ID √∫nico del documento en Tu Pana
- `folio` (String): Folio asignado por el SII
- `date_issued` (String): Fecha de emisi√≥n (formato YYYY-MM-DD)
- `amount_with_iva` (Number): Monto total con IVA incluido
- `is_sandbox` (Boolean): Indica si es un documento de prueba

**dte_type (Object):**
- `code` (String): C√≥digo del tipo de documento
- `description` (String): Descripci√≥n del tipo de documento

**sender (Object):**
- `id` (Integer): ID del emisor en Tu Pana
- `name` (String): Nombre/raz√≥n social del emisor
- `tax_id` (String): RUT del emisor (formato con puntos y gui√≥n)
- `email` (String): Email del emisor

**receiver (Object):**
- `id` (Integer): ID del receptor en Tu Pana
- `name` (String): Nombre/raz√≥n social del receptor
- `tax_id` (String): RUT del receptor (formato con puntos y gui√≥n)
- `email` (String): Email del receptor

**header (Object):**
- `purchase_transaction_type` (Integer): Tipo de transacci√≥n de compra
- `sale_transaction_type` (Integer): Tipo de transacci√≥n de venta
- `payment_method` (String): M√©todo de pago
- `due_date` (String): Fecha de vencimiento (formato YYYY-MM-DD)
- `retention_type` (String): Tipo de retenci√≥n (solo para boletas de honorarios)

**document_issuer (Object):**
- `rut` (String): RUT del emisor
- `business_name` (String): Raz√≥n social
- `business_activity` (String): Giro o actividad econ√≥mica
- `phone_number` (String): Tel√©fono
- `email` (String): Email
- `activity_code` (Integer): C√≥digo de actividad econ√≥mica
- `sii_branch_code` (String): C√≥digo de sucursal SII
- `address` (String): Direcci√≥n
- `district` (String): Comuna
- `city` (String): Ciudad

**document_receiver (Object):**
- `rut` (String): RUT del receptor
- `business_name` (String): Raz√≥n social
- `business_activity` (String): Giro o actividad econ√≥mica
- `contact` (String): Contacto
- `address` (String): Direcci√≥n
- `district` (String): Comuna
- `city` (String): Ciudad

**document_total (Object):**
- `net_amount` (Number): Monto neto (sin IVA)
- `iva_rate` (Number): Tasa de IVA aplicada
- `iva_amount` (Number): Monto del IVA
- `total_amount` (Number): Monto total

**details (Array):**
Lista de productos/servicios del documento. Cada elemento contiene:
- `item_name` (String): Nombre del producto/servicio
- `item_description` (String): Descripci√≥n del producto/servicio
- `quantity` (Number): Cantidad
- `unit_price` (Number): Precio unitario
- `item_total` (Number): Total del √≠tem
- `item_code` (String): C√≥digo del producto/servicio
- `item_type_code` (String): C√≥digo del tipo de √≠tem
- `unit` (String): Unidad de medida
- `discount_percent` (Number): Porcentaje de descuento
- `other_tax` (Number): Otros impuestos

**references (Array):**
Referencias a otros documentos (solo para notas de cr√©dito). Cada elemento contiene:
- `dte_type_code` (String): C√≥digo del tipo de DTE de referencia
- `reference_folio` (String): Folio del documento referenciado
- `reference_date` (String): Fecha del documento referenciado
- `reference_reason` (String): Raz√≥n de la referencia

**Archivos generados:**
- `pdf_file` (String): URL temporal para descargar el PDF del documento
- `xml_file` (String): URL temporal para descargar el XML del documento

**json_param (Object):**
- **Descripci√≥n:** Campos personalizados adicionales que se pueden incluir en el documento
- **Estructura:** Objeto flexible que puede contener cualquier informaci√≥n adicional



## Consideraciones Especiales por Tipo de Documento

### Ejemplos de Uso por Tipo de Documento

#### Factura Electr√≥nica (DTE 33)

```json
{
  "documents": [
    {
      "dte_type": {
        "code": "33"
      },
      "date_issued": "2024-01-15",
      "document_issuer": {
        "rut": "12345678-9",
        "business_name": "Mi Empresa SpA"
      },
      "document_receiver": {
        "rut": "98765432-1",
        "business_name": "Cliente Importante Ltda"
      },
      "details": [
        {
          "item_name": "Servicio de Consultor√≠a",
          "quantity": 1,
          "unit_price": 100000,
          "item_total": 100000
        }
      ]
    }
  ]
}
```



#### Factura de Compra (DTE 46)

```json
{
  "documents": [
    {
      "dte_type": {
        "code": "46"
      },
      "date_issued": "2024-01-15",
      "document_issuer": {
        "rut": "98765432-1",
        "business_name": "Proveedor SpA"
      },
      "document_receiver": {
        "rut": "12345678-9",
        "business_name": "Mi Empresa SpA"
      },
      "header": {
        "purchase_transaction_type": 1,
        "payment_method": "2"
      },
      "details": [
        {
          "item_name": "Equipo de Oficina",
          "quantity": 2,
          "unit_price": 50000,
          "item_total": 100000
        }
      ]
    }
  ]
}
```



#### Factura de Exportaci√≥n (DTE 110)

```json
{
  "documents": [
    {
      "dte_type": {
        "code": "110"
      },
      "date_issued": "2024-01-15",
      "document_issuer": {
        "rut": "12345678-9",
        "business_name": "Exportadora SpA"
      },
      "document_receiver": {
        "rut": "99999999-9",
        "business_name": "Importador Internacional Inc",
        "address": "123 Main Street",
        "city": "New York",
        "country": "USA"
      },
      "header": {
        "sale_transaction_type": 1,
        "currency": "USD"
      },
      "export_data": {
        "transport_mode": "2",
        "destination_country": "US",
        "destination_port": "JFK",
        "origin_port": "SCL",
        "export_clause": "1"
      },
      "details": [
        {
          "item_name": "Producto Exportado",
          "quantity": 100,
          "unit_price": 50,
          "item_total": 5000
        }
      ]
    }
  ]
}
```



#### Nota de Cr√©dito (DTE 61)

```json
{
  "documents": [
    {
      "dte_type": {
        "code": "61"
      },
      "date_issued": "2024-01-16",
      "document_issuer": {
        "rut": "12345678-9",
        "business_name": "Mi Empresa SpA"
      },
      "document_receiver": {
        "rut": "98765432-1",
        "business_name": "Cliente Importante Ltda"
      },
      "references": [
        {
          "dte_type_code": "33",
          "reference_folio": 12345,
          "reference_date": "2024-01-15",
          "reference_reason": "Correcci√≥n de precio"
        }
      ],
      "details": [
        {
          "item_name": "Ajuste por Correcci√≥n",
          "quantity": 1,
          "unit_price": -5000,
          "item_total": -5000
        }
      ]
    }
  ]
}
```

#### Boleta de Honorarios de Terceros (DTE 90)

Ejemplo m√≠nimo con **header `X-Use-Defaults: true`**: con solo RUT en emisor y receptor el backend completa `business_name` y el resto si existen en Tu Pana; calcula `item_total`; usa fecha actual si se omite `date_issued`.

```json
{
  "documents": [
    {
      "dte_type": {
        "code": "90"
      },
      "document_issuer": {
        "rut": "76543210-3"
      },
      "document_receiver": {
        "rut": "12345678-9"
      },
      "header": {
        "retention_type": "RETRECEPTOR"
      },
      "details": [
        {
          "item_name": "Servicio de reparto de pedidos",
          "quantity": 1,
          "unit_price": 15000
        }
      ]
    }
  ]
}
```

## üßæ **Factura de Compra (DTE 46)**

### Campos espec√≠ficos del header:
- **`purchase_transaction_type`** (Integer, Obligatorio):
  - `1`: Compras del giro - Productos/servicios relacionados con tu actividad principal
  - `2`: Compras fuera del giro - Productos/servicios no relacionados con tu actividad principal
  - `3`: Activo fijo - Bienes que se incorporan al patrimonio de la empresa (maquinaria, muebles, etc.)

- **`payment_method`** (String, Opcional):
  - `"1"`: Contado - Pago inmediato
  - `"2"`: Cr√©dito - Pago diferido
  - `"3"`: Sin costo - Producto/servicio recibido gratuitamente

### Validaciones importantes:
- **Registro contable**: Este documento genera asiento autom√°tico en tu contabilidad
- **IVA recuperable**: El IVA pagado puede ser recuperado seg√∫n el tipo de compra
- **Proveedor extranjero**: Si el proveedor es extranjero, usar RUT gen√©rico `55555555-5`
- **Fecha l√≠mite**: Las compras deben registrarse dentro del mes siguiente a la recepci√≥n

### Casos de uso comunes:
- Registro de compras a proveedores locales
- Incorporaci√≥n de activos fijos
- Servicios profesionales recibidos
- Compras de materias primas o insumos


## ‚úàÔ∏è **Factura de Exportaci√≥n (DTE 110)**

### Campos requeridos en export_data:

- **`transport_mode`** (String, Obligatorio):
  - `"1"`: Mar√≠timo - Env√≠o por barco
  - `"2"`: A√©reo - Env√≠o por avi√≥n
  - `"3"`: Terrestre - Env√≠o por tierra (cami√≥n, tren)
  - `"4"`: Multimodal - Combinaci√≥n de modos de transporte

- **`destination_country`** (String, Obligatorio):
  - C√≥digo ISO del pa√≠s de destino (ej: `"US"`, `"BR"`, `"AR"`)
  - Debe coincidir con el pa√≠s del receptor

- **`destination_port`** (String, Obligatorio):
  - Nombre del puerto/aeropuerto/ciudad de destino
  - Ejemplos: `"JFK"`, `"Santos"`, `"Buenos Aires"`

- **`origin_port`** (String, Obligatorio):
  - Nombre del puerto/aeropuerto/ciudad de origen en Chile
  - Ejemplos: `"SCL"`, `"IQQ"`, `"ANF"`

- **`export_clause`** (String, Obligatorio):
  - `"1"`: A firme - Compromiso incondicional de exportar
  - `"2"`: Bajo protesta - Exportaci√≥n sujeta a condiciones
  - `"3"`: Sin cl√°usula - Exportaci√≥n sin especificar condiciones

### Campos espec√≠ficos del header:

- **`sale_transaction_type`** (Integer, Obligatorio):
  - `1`: Operaci√≥n constituye venta - Venta normal
  - `2`: Ventas por acto o contrato - Contratos especiales
  - `3`: Boleto de pasaje - Para agencias de viajes

- **`currency`** (String, Obligatorio):
  - `"USD"`: D√≥lares americanos
  - `"EUR"`: Euros
  - `"CLP"`: Pesos chilenos
  - `"UF"`: Unidades de Fomento

### Informaci√≥n del receptor extranjero:
- **RUT**: Puede usar identificadores especiales como `99999999-9` para extranjeros
- **Direcci√≥n**: Direcci√≥n completa en el extranjero
- **Pa√≠s**: Pa√≠s de destino (debe coincidir con `destination_country`)

### Precios y c√°lculos:
- **FOB (Free on Board)**: Los precios deben incluir costos hasta la entrega al transportista
- **Moneda**: Debe coincidir con `header.currency`
- **Sin IVA**: Las exportaciones est√°n exentas de IVA chileno

### Requisitos legales:
- **Registro de exportaci√≥n**: Debe estar registrado en el sistema aduanero
- **Certificado de origen**: Puede requerirse seg√∫n acuerdos comerciales
- **Documentos aduaneros**: Factura comercial, certificado de origen, etc.


## üíº **Boletas de Honorarios (DTE 80, 90)**

### Campos espec√≠ficos del header:

- **`retention_type`** (String, Obligatorio):
  - `"RETRECEPTOR"`: La retenci√≥n la realiza el receptor (99% de los casos)
  - `"RETCONTRIBUYENTE"`: La retenci√≥n la realiza el contribuyente emisor (casos excepcionales)

### Retenci√≥n autom√°tica del 14.5%:
- **C√°lculo**: Se aplica sobre el monto bruto antes de IVA
- **Responsable**: Normalmente el pagador retiene y declara el impuesto
- **Pago al profesional**: Se paga el 85.5% restante (bruto menos retenci√≥n)

### Informaci√≥n del receptor (profesional):
- **Campos opcionales**: A diferencia de facturas, no todos los datos son obligatorios
- **RUT obligatorio**: Siempre se requiere el RUT del profesional
- **Actividad econ√≥mica**: Debe corresponder a servicios profesionales

### Diferencias entre DTE 80 y 90:

**DTE 80 - Boleta de Honorarios:**
- Emisi√≥n directa por el pagador al profesional
- Relaci√≥n directa pagador-profesional
- **document_issuer**: Quien paga (empresa o persona que contrata)

**DTE 90 - Boleta de Honorarios de Terceros:**
- Emisi√≥n por intermediario (plataformas, marketplaces)
- **document_issuer**: Contribuyente real (quien paga ‚Äî restaurante, empresa cliente)
- **document_receiver**: Profesional que recibe (repartidor, freelancer, instructor)
- Requiere enrolamiento de usuarios autorizados para emisi√≥n por terceros
- Misma estructura de request que DTE 80; solo cambia `dte_type.code: "90"`

### Validaciones espec√≠ficas:
- **Tope mensual**: L√≠mite de emisi√≥n sin retenci√≥n ampliada
- **Tipo de servicio**: Debe corresponder a honorarios profesionales
- **Declaraci√≥n**: El retenedor debe declarar y pagar el impuesto retenido

### Casos de uso:
- **DTE 80**: Honorarios de abogados, contadores, m√©dicos; servicios de consultor√≠a; pagos directos a freelancers
- **DTE 90**: Apps de delivery (Rappi, Uber Eats); plataformas freelance; marketplaces de servicios; plataformas educativas


## üîí **Seguridad y URLs temporales**

### URLs de archivos temporales:
- **PDF y XML**: URLs v√°lidas por 1 hora aproximadamente
- **Autenticaci√≥n**: Incluyen tokens de acceso autom√°tico
- **Recomendaci√≥n**: Descargar inmediatamente al recibir el webhook

### Medidas de seguridad:
- **Encriptaci√≥n**: Archivos transmitidos de forma segura
- **Validaci√≥n**: Solo el emisor puede acceder a sus documentos
- **Auditor√≠a**: Todas las descargas quedan registradas

